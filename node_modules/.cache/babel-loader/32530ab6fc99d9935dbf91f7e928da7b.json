{"remainingRequest":"D:\\app\\emoji\\node_modules\\babel-loader\\lib\\index.js!D:\\app\\emoji\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\app\\emoji\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\app\\emoji\\src\\components\\EmojiComponent.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\app\\emoji\\src\\components\\EmojiComponent.vue","mtime":1598332997818},{"path":"D:\\app\\emoji\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1598317445799},{"path":"D:\\app\\emoji\\node_modules\\babel-loader\\lib\\index.js","mtime":1598317476072},{"path":"D:\\app\\emoji\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1598317445799},{"path":"D:\\app\\emoji\\node_modules\\vue-loader\\lib\\index.js","mtime":1598317469815}],"contextDependencies":[],"result":["import _toConsumableArray from \"D:\\\\app\\\\emoji\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/es6.array.map\";\nimport \"core-js/modules/es6.string.trim\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  name: 'EmojiComponent',\n  props: {\n    disabled: {\n      //是否禁用\n      type: Boolean,\n      default: false\n    },\n    showWordLimit: {\n      //是否显示输入字数统计 max等于0则不显示\n      type: Boolean,\n      default: true\n    },\n    clearable: {\n      //是否可清空\n      type: Boolean,\n      default: true\n    },\n    max: {\n      //可输入的最大长度 等于0则不限制\n      type: Number,\n      default: 0\n    },\n    placeholder: {\n      //占位符\n      type: String,\n      default: '请输入内容'\n    },\n    value: {\n      //绑定值\n      type: String,\n      default: ''\n    }\n  },\n  data: function data() {\n    return {\n      content: '',\n      startOffset: 0,\n      range: null,\n      total: 0,\n      typing: false,\n      //输入状态\n      exportContent: '',\n      canEdit: this.disabled ? false : 'plaintext-only'\n    };\n  },\n  mounted: function mounted() {\n    this.init();\n  },\n  watch: {\n    content: function content(old, news) {\n      if (old == news) return;\n      console.log(old, news);\n      this.$emit('change', this.getContent());\n    }\n  },\n  methods: {\n    lineFeed: function lineFeed(h) {\n      //输出换行符\n      return h.replace(/[\\r\\n]/g, '<br>');\n    },\n    init: function init() {\n      //初始化\n      var $content = document.querySelector('#contenteditable'),\n          range = this.range,\n          selection = getSelection();\n      this.content = this.value;\n      $content.innerHTML = this.content;\n      $content.focus();\n\n      if (!this.disabled) {\n        range = selection.getRangeAt(0);\n        range.selectNodeContents($content);\n        range.collapse(false);\n        selection.removeAllRanges();\n        selection.addRange(range);\n      }\n\n      this.calc();\n    },\n    getContent: function getContent() {\n      //获取内容\n      return this.lineFeed(this.content.replace(/<((?!img).+?)>/g, function ($1, $2) {\n        return \"&lt;\".concat($2, \"&gt;\");\n      }).trim());\n    },\n    clear: function clear() {\n      //清空内容 重置\n      this.content = '';\n      this.exportContent = '';\n      this.total = 0;\n      this.startOffset = 0;\n      document.querySelector('#contenteditable').innerHTML = '';\n    },\n    keydown: function keydown(e) {\n      var _this = this;\n\n      //达到最大字数时，除了删除shift方向键，其他不可用\n      var key = e.keyCode || e.which;\n\n      if (this.max !== 0 && this.total >= this.max) {\n        if (key != 8 && key != 46 && key != 16 && key != 37 && key != 38 && key != 39 && key != 40) {\n          this.canEdit = false;\n          setTimeout(function () {\n            _this.canEdit = 'plaintext-only';\n          }, 0);\n        }\n      }\n    },\n    calc: function calc() {\n      //计算字数\n      var $content = document.querySelector('#contenteditable');\n      var emojiTimes = 0;\n\n      for (var i = 0; i < $content.childNodes.length; i++) {\n        var nodeName = $content.childNodes[i].nodeName;\n        if (nodeName.toLowerCase() == 'img') emojiTimes++;\n      }\n\n      this.total = $content.innerText.replace(/\\s{1}[\\r\\n]/g, '-').trim().length + emojiTimes;\n\n      if (this.max !== 0 && this.total > this.max) {\n        var out = '',\n            _i = 0;\n\n        for (var c = 0; c < $content.childNodes.length; c++) {\n          if (_i > this.max) break;\n          var $c = $content.childNodes[c];\n\n          if ($c.nodeName.toLowerCase() == 'img') {\n            out += $c.outerHTML;\n            _i++;\n          } else {\n            var $n = $c.nodeValue,\n                len = $n.length;\n            _i += len;\n            _i <= this.max ? out += $n : out += $n.substr(0, len + this.max - _i);\n          }\n        }\n\n        this.content = out;\n        $content.innerHTML = out;\n        this.total = this.max;\n        return false;\n      }\n\n      return true;\n    },\n    input: function input() {\n      var _this2 = this;\n\n      //定时器确保compositionend已经执行\n      setTimeout(function () {\n        if (_this2.typing || !_this2.calc() || _this2.max !== 0 && _this2.total >= _this2.max) return;\n        var $content = document.querySelector('#contenteditable'),\n            child = $content.childNodes;\n        $content.scrollTop = $content.offsetHeight;\n        _this2.content = _toConsumableArray(child).map(function (i) {\n          return i.nodeName.toLowerCase() == 'img' ? i.outerHTML : i.nodeValue;\n        }).join('');\n      }, 0);\n    },\n    focus: function focus(e) {\n      //点击或聚焦\n      if (e.target.id != 'contenteditable') return;\n      var selection = getSelection();\n      if (!selection) return;\n      var node = selection.anchorNode;\n      if (!node) return;\n      this.range = selection.getRangeAt(0);\n      this.startOffset = this.range.startOffset;\n    },\n    addEmoji: function addEmoji(src) {\n      //添加Emoji\n      if (this.disabled) return;\n      if (this.max !== 0 && this.total >= this.max) return;\n      var $content = document.querySelector('#contenteditable'),\n          range = this.range,\n          selection = getSelection(),\n          emoji = document.createElement(\"img\");\n      emoji.src = src;\n\n      if (!range || !selection.anchorNode) {\n        range = document.createRange();\n        range.selectNodeContents($content);\n        $content.focus();\n      }\n\n      var textNode = range.startContainer,\n          isBr = textNode.nodeName.toLowerCase() == 'br',\n          child = $content.childNodes;\n\n      if (selection.anchorNode.nodeName != '#text') {\n        if (child.length > 0) {\n          for (var i = 0; i <= child.length; i++) {\n            if (i == selection.anchorOffset) {\n              $content.insertBefore(emoji, child[i]);\n              child[i + 1] ? range.setStartBefore(child[i + 1]) : range.selectNodeContents($content);\n              break;\n            }\n          }\n        } else {\n          $content.appendChild(emoji);\n          range.selectNodeContents($content);\n        }\n      } else {\n        range.insertNode(emoji);\n        range.setStart(textNode, this.startOffset);\n      }\n\n      this.total++;\n      this.content = _toConsumableArray(child).map(function (i) {\n        return i.nodeName.toLowerCase() == 'img' ? i.outerHTML : i.nodeValue;\n      }).join('');\n      range.collapse(false);\n      selection.removeAllRanges();\n      selection.addRange(range);\n    }\n  }\n};",{"version":3,"sources":["EmojiComponent.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"emoji\">\r\n  \t<div class=\"teatarea\">\r\n  \t\t<div class=\"field\">\r\n  \t\t\t<div id=\"contenteditable\" :class=\"{wordLimit: max === 0 || !showWordLimit}\" :contenteditable=\"canEdit\" @compositionstart=\"typing = true\" @compositionend=\"typing = false\" :placeholder=\"placeholder\" @keyup=\"focus\" @keydown=\"keydown\" @input=\"input\" @click=\"focus\"></div>\r\n  \t\t\t<div class=\"total\" v-if=\"showWordLimit && max !== 0\">{{total}} / {{max}}</div>\r\n  \t\t\t<span class=\"clear\" @click=\"clear\" v-if=\"!disabled && clearable && content\">\r\n  \t\t\t\t<svg class=\"icon\" style=\"width: 1.4em; height: 1.4em; vertical-align: middle; fill: currentColor;overflow: hidden;\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"328\"><path d=\"M878.08 731.274667a32 32 0 0 1-54.88-32.938667A360.789333 360.789333 0 0 0 874.666667 512c0-200.298667-162.368-362.666667-362.666667-362.666667S149.333333 311.701333 149.333333 512s162.368 362.666667 362.666667 362.666667a360.789333 360.789333 0 0 0 186.314667-51.445334 32 32 0 0 1 32.928 54.88A424.778667 424.778667 0 0 1 512 938.666667C276.362667 938.666667 85.333333 747.637333 85.333333 512S276.362667 85.333333 512 85.333333s426.666667 191.029333 426.666667 426.666667c0 78.293333-21.152 153.568-60.586667 219.274667zM555.232 512l86.474667 86.474667a30.570667 30.570667 0 1 1-43.232 43.232L512 555.232l-86.474667 86.474667a30.570667 30.570667 0 1 1-43.232-43.232L468.768 512l-86.474667-86.474667a30.570667 30.570667 0 1 1 43.232-43.232L512 468.768l86.474667-86.474667a30.570667 30.570667 0 1 1 43.232 43.232L555.232 512z\" p-id=\"329\"></path></svg>\r\n  \t\t\t</span>\r\n  \t\t</div>\r\n  \t</div>\r\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'EmojiComponent',\n  props: {\r\n\t\tdisabled: { //是否禁用\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t},\n    showWordLimit: { //是否显示输入字数统计 max等于0则不显示\r\n    \ttype: Boolean,\r\n    \tdefault: true\r\n    },\r\n    clearable: { //是否可清空\r\n    \ttype: Boolean,\r\n    \tdefault: true\r\n    },\r\n    max: { //可输入的最大长度 等于0则不限制\r\n    \ttype: Number,\r\n    \tdefault: 0\r\n    },\r\n    placeholder: { //占位符\r\n    \ttype: String,\r\n    \tdefault: '请输入内容'\r\n    },\r\n    value: { //绑定值\r\n    \ttype: String,\r\n    \tdefault: ''\r\n    }\n  },\r\n\tdata(){\r\n\t\treturn {\r\n\t\t\tcontent: '',\r\n\t\t\tstartOffset: 0,\r\n\t\t\trange: null,\r\n\t\t\ttotal: 0,\r\n\t\t\ttyping: false, //输入状态\r\n\t\t\texportContent: '',\r\n\t\t\tcanEdit: this.disabled ? false : 'plaintext-only',\r\n\t\t}\r\n\t},\r\n\tmounted(){\r\n\t\tthis.init()\r\n\t},\r\n\twatch: {\r\n\t\tcontent(old, news){\r\n\t\t\tif (old == news) return\r\n\t\t\tconsole.log(old, news)\r\n\t\t\tthis.$emit('change', this.getContent())\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tlineFeed(h){\r\n\t\t\t//输出换行符\r\n\t\t\treturn h.replace(/[\\r\\n]/g, '<br>')\r\n\t\t},\r\n\t\tinit(){\r\n\t\t\t//初始化\r\n\t\t\tlet $content = document.querySelector('#contenteditable'),\r\n\t\t\t\trange = this.range,\r\n\t\t\t\tselection = getSelection()\r\n\t\t\tthis.content = this.value\r\n\t\t\t$content.innerHTML = this.content\r\n\t\t\t$content.focus()\r\n\t\t\tif (!this.disabled) {\r\n\t\t\t\trange = selection.getRangeAt(0)\r\n\t\t\t\trange.selectNodeContents($content)\r\n\t\t\t\trange.collapse(false)\r\n\t\t\t\tselection.removeAllRanges()\r\n\t\t\t\tselection.addRange(range)\r\n\t\t\t}\r\n\t\t\tthis.calc()\r\n\t\t},\r\n\t\tgetContent(){\r\n\t\t\t//获取内容\r\n\t\t\treturn this.lineFeed(this.content.replace(/<((?!img).+?)>/g, ($1, $2) => `&lt;${$2}&gt;`).trim())\r\n\t\t},\r\n\t\tclear(){\r\n\t\t\t//清空内容 重置\r\n\t\t\tthis.content = ''\r\n\t\t\tthis.exportContent = ''\r\n\t\t\tthis.total = 0\r\n\t\t\tthis.startOffset = 0\r\n\t\t\tdocument.querySelector('#contenteditable').innerHTML = ''\r\n\t\t},\r\n\t\tkeydown(e){\r\n\t\t\t//达到最大字数时，除了删除shift方向键，其他不可用\r\n\t\t\tconst key = e.keyCode || e.which\r\n\t\t\tif (this.max !== 0 && this.total >= this.max) {\r\n\t\t\t\tif (key != 8 && key != 46 && key != 16 && key != 37 && key != 38 && key != 39 && key != 40) {\r\n\t\t\t\t\tthis.canEdit = false\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.canEdit = 'plaintext-only'\r\n\t\t\t\t\t}, 0)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tcalc(){\r\n\t\t\t//计算字数\r\n\t\t\tconst $content = document.querySelector('#contenteditable')\r\n\t\t\tlet emojiTimes = 0\r\n\t\t\tfor (let i = 0; i < $content.childNodes.length; i++) {\r\n\t\t\t\tconst { nodeName } = $content.childNodes[i]\r\n\t\t\t\tif (nodeName.toLowerCase() == 'img') emojiTimes++\r\n\t\t\t}\r\n\t\t\tthis.total = $content.innerText.replace(/\\s{1}[\\r\\n]/g, '-').trim().length + emojiTimes\r\n\t\t\tif (this.max !== 0 && this.total > this.max){\r\n\t\t\t\tlet out = '', i = 0\r\n\t\t\t\tfor (let c = 0; c < $content.childNodes.length; c++) {\r\n\t\t\t\t\tif (i > this.max) break\r\n\t\t\t\t\tconst $c = $content.childNodes[c]\r\n\t\t\t\t\tif ($c.nodeName.toLowerCase() == 'img') {\r\n\t\t\t\t\t\tout += $c.outerHTML\r\n\t\t\t\t\t\ti++\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst $n = $c.nodeValue, len = $n.length\r\n\t\t\t\t\t\ti += len\r\n\t\t\t\t\t\ti <= this.max ? out += $n : out += $n.substr(0, len + this.max - i)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.content = out\r\n\t\t\t\t$content.innerHTML = out\r\n\t\t\t\tthis.total = this.max\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t\treturn true\r\n\t\t},\r\n\t\tinput(){\r\n\t\t\t//定时器确保compositionend已经执行\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tif (this.typing || !this.calc() || (this.max !== 0 && this.total >= this.max)) return\r\n\t\t\t\tconst $content = document.querySelector('#contenteditable'),\r\n\t\t\t\t\tchild = $content.childNodes\r\n\t\t\t\t$content.scrollTop = $content.offsetHeight\r\n\t\t\t\tthis.content = [...child].map(i => i.nodeName.toLowerCase() == 'img' ? i.outerHTML : i.nodeValue).join('')\r\n\t\t\t}, 0)\r\n\t\t},\r\n\t\tfocus(e){\r\n\t\t\t//点击或聚焦\r\n\t\t\tif (e.target.id != 'contenteditable') return\r\n\t\t\tconst selection = getSelection()\r\n\t\t\tif (!selection) return\r\n\t\t\tconst node = selection.anchorNode\r\n\t\t\tif (!node) return\r\n\t\t\tthis.range = selection.getRangeAt(0)\r\n\t\t\tthis.startOffset = this.range.startOffset\r\n\t\t},\r\n\t\taddEmoji(src){\r\n\t\t\t//添加Emoji\r\n\t\t\tif (this.disabled) return\r\n\t\t\tif (this.max !== 0 && this.total >= this.max) return\r\n\t\t\tlet $content = document.querySelector('#contenteditable'),\r\n\t\t\t\trange = this.range,\r\n\t\t\t\tselection = getSelection(),\r\n\t\t\t\temoji = document.createElement(\"img\")\r\n\t\t\temoji.src = src;\r\n\t\t\tif (!range || !selection.anchorNode) {\r\n\t\t\t\trange = document.createRange()\r\n\t\t\t\trange.selectNodeContents($content)\r\n\t\t\t\t$content.focus()\r\n\t\t\t}\r\n\t\t\tconst\ttextNode = range.startContainer,\r\n\t\t\t\tisBr = textNode.nodeName.toLowerCase() == 'br',\r\n\t\t\t\tchild = $content.childNodes\r\n\t\t\tif (selection.anchorNode.nodeName != '#text') {\r\n\t\t\t\tif (child.length > 0) {\r\n\t\t\t\t\tfor (let i = 0; i <= child.length; i++) {\r\n\t\t\t\t\t\tif (i == selection.anchorOffset) {\r\n\t\t\t\t\t\t\t$content.insertBefore(emoji, child[i])\r\n\t\t\t\t\t\t\tchild[i + 1] ? range.setStartBefore(child[i + 1]) : range.selectNodeContents($content)\r\n\t\t\t\t\t\t\tbreak\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$content.appendChild(emoji)\r\n\t\t\t\t\trange.selectNodeContents($content)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\trange.insertNode(emoji)\r\n\t\t\t\trange.setStart(textNode, this.startOffset)\r\n\t\t\t}\r\n\t\t\tthis.total++\r\n\t\t\tthis.content = [...child].map(i => i.nodeName.toLowerCase() == 'img' ? i.outerHTML : i.nodeValue).join('')\r\n\t\t\trange.collapse(false)\r\n\t\t\tselection.removeAllRanges()\r\n\t\t\tselection.addRange(range)\r\n\t\t}\r\n\t}\n}\n</script>\n\n<style lang=\"scss\" scoped>\r\n\t.emoji {\n\t\t.teatarea {\r\n\t\t\twidth: 100%;\r\n\t\t\tmargin: 0 auto;\r\n\t\t\t.field {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\t#contenteditable {\r\n\t\t\t\t\tmargin: 12px 0;\r\n\t\t\t\t\tpadding: 10px 12px 32px;\r\n\t\t\t\t\tline-height: 1.8;\r\n\t\t\t\t\tmax-height: 100px;\r\n\t\t\t\t\tborder: 1px solid #ddd;\r\n\t\t\t\t\tborder-radius: 5px;\r\n\t\t\t\t\tfont-size: 14px;\r\n\t\t\t\t\ttext-align: left;\r\n\t\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\t\toutline: none;\r\n\t\t\t\t\toverflow-y: auto;\r\n\t\t\t\t\t&:focus {\r\n\t\t\t\t\t\tborder: 1px solid #409eff;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t&:empty::before {\r\n\t\t\t\t\t\tcolor: #ddd;\r\n\t\t\t\t\t\tcontent: attr(placeholder);\r\n\t\t\t\t\t}\r\n\t\t\t\t\timg {\r\n\t\t\t\t\t\tvertical-align: bottom;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t&.wordLimit {\r\n\t\t\t\t\t\tpadding-bottom: 10px;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t.total, .clear {\r\n\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\tbottom: 1px;\r\n\t\t\t\t\tleft: 12px;\r\n\t\t\t\t\tbackground: #fff;\r\n\t\t\t\t\tcolor: #aaa;\r\n\t\t\t\t\tfont-size: 12px;\r\n\t\t\t\t\tpadding: 6px;\r\n\t\t\t\t\tpointer-events: none;\r\n\t\t\t\t}\r\n\t\t\t\t.clear {\r\n\t\t\t\t\tleft: auto;\r\n\t\t\t\t\tright: 12px;\r\n\t\t\t\t\tbottom: 4px;\r\n\t\t\t\t\tcursor: pointer;\r\n\t\t\t\t\tpadding: 0;\r\n\t\t\t\t\tpointer-events: all;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t.exportContent {\r\n\t\t\t\tmargin: 30px 0;\r\n\t\t\t\timg {\r\n\t\t\t\t\tvertical-align: bottom;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t.button {\r\n\t\t\t\tbackground: #409eff;\r\n\t\t\t\tmargin: 0 8px;\r\n\t\t\t\tpadding: 6px 10px;\r\n\t\t\t\tcolor: #fff;\r\n\t\t\t\tborder-radius: 5px;\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t\tborder: 0;\r\n\t\t\t\tfont-size: 14px;\r\n\t\t\t\toutline: none;\r\n\t\t\t\t&:active {\r\n\t\t\t\t\tborder: 0;\r\n\t\t\t\t\toutline: none;\r\n\t\t\t\t}\r\n\t\t\t\t&:hover {\r\n\t\t\t\t\topacity: .8;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\n</style>\n"],"sourceRoot":"src/components"}]}