{"remainingRequest":"D:\\app\\emoji\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\app\\emoji\\src\\components\\EmojiComponent.vue?vue&type=style&index=0&id=e57493f2&lang=scss&scoped=true&","dependencies":[{"path":"D:\\app\\emoji\\src\\components\\EmojiComponent.vue","mtime":1598318089573},{"path":"D:\\app\\emoji\\node_modules\\css-loader\\index.js","mtime":1598317424191},{"path":"D:\\app\\emoji\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1598317469866},{"path":"D:\\app\\emoji\\node_modules\\postcss-loader\\src\\index.js","mtime":1598317475254},{"path":"D:\\app\\emoji\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\app\\emoji\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1598317445799},{"path":"D:\\app\\emoji\\node_modules\\vue-loader\\lib\\index.js","mtime":1598317469815}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.emoji-main {\n\t.teatarea {\n\t\twidth: 100%;\n\t\tmargin: 0 auto;\n\t\t.field {\n\t\t\tposition: relative;\n\t\t\twidth: 100%;\n\t\t\t#contenteditable {\n\t\t\t\tmargin: 12px 0;\n\t\t\t\tpadding: 10px 12px 32px;\n\t\t\t\tline-height: 1.8;\n\t\t\t\tmax-height: 100px;\n\t\t\t\tborder: 1px solid #ddd;\n\t\t\t\tborder-radius: 5px;\n\t\t\t\tfont-size: 14px;\n\t\t\t\tbox-sizing: border-box;\n\t\t\t\toutline: none;\n\t\t\t\toverflow-y: auto;\n\t\t\t\t&:focus {\n\t\t\t\t\tborder: 1px solid #409eff;\n\t\t\t\t}\n\t\t\t\t&:empty::before {\n\t\t\t\t\tcolor: #ddd;\n\t\t\t\t\tcontent: attr(placeholder);\n\t\t\t\t}\n\t\t\t\timg {\n\t\t\t\t\tvertical-align: bottom;\n\t\t\t\t}\n\t\t\t\t.wordLimit {\n\t\t\t\t\tpadding-bottom: 10px;\n\t\t\t\t}\n\t\t\t}\n\t\t\t.total, .clear {\n\t\t\t\tposition: absolute;\n\t\t\t\tbottom: 1px;\n\t\t\t\tleft: 12px;\n\t\t\t\tbackground: #fff;\n\t\t\t\tcolor: #aaa;\n\t\t\t\tfont-size: 12px;\n\t\t\t\tpadding: 6px;\n\t\t\t\tpointer-events: none;\n\t\t\t}\n\t\t\t.clear {\n\t\t\t\tleft: auto;\n\t\t\t\tright: 12px;\n\t\t\t\tbottom: 4px;\n\t\t\t\tcursor: pointer;\n\t\t\t\tpadding: 0;\n\t\t\t\tpointer-events: all;\n\t\t\t}\n\t\t}\n\t\t.exportContent {\n\t\t\tmargin: 30px 0;\n\t\t\timg {\n\t\t\t\tvertical-align: bottom;\n\t\t\t}\n\t\t}\n\t\t.em-button {\n\t\t\tbackground: #409eff;\n\t\t\tpadding: 6px 10px;\n\t\t\tcolor: #fff;\n\t\t\tborder-radius: 5px;\n\t\t\tcursor: pointer;\n\t\t\tborder: 0;\n\t\t\tfont-size: 14px;\n\t\t\toutline: none;\n\t\t\t&:active {\n\t\t\t\tborder: 0;\n\t\t\t\toutline: none;\n\t\t\t}\n\t\t\t&:hover {\n\t\t\t\topacity: .8;\n\t\t\t}\n\t\t}\n\t}\n}\n",{"version":3,"sources":["EmojiComponent.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EmojiComponent.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"emoji-main\">\r\n  \t<div class=\"teatarea\">\r\n  \t\t<div class=\"field\">\r\n  \t\t\t<div id=\"contenteditable\" :class=\"{wordLimit: !showWordLimit}\" :contenteditable=\"canEdit\" @compositionstart=\"typing = true\" @compositionend=\"typing = false\" :placeholder=\"placeholder\" @keyup=\"focus\" @keydown=\"keydown\" @input=\"input\" @click=\"focus\"></div>\r\n  \t\t\t<div class=\"total\" v-if=\"showWordLimit\">{{total}} / {{max}}</div>\r\n  \t\t\t<span class=\"clear\" @click=\"clear\" v-if=\"clearable && content\">\r\n  \t\t\t\t<svg class=\"icon\" style=\"width: 1.4em; height: 1.4em; vertical-align: middle; fill: currentColor;overflow: hidden;\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"328\"><path d=\"M878.08 731.274667a32 32 0 0 1-54.88-32.938667A360.789333 360.789333 0 0 0 874.666667 512c0-200.298667-162.368-362.666667-362.666667-362.666667S149.333333 311.701333 149.333333 512s162.368 362.666667 362.666667 362.666667a360.789333 360.789333 0 0 0 186.314667-51.445334 32 32 0 0 1 32.928 54.88A424.778667 424.778667 0 0 1 512 938.666667C276.362667 938.666667 85.333333 747.637333 85.333333 512S276.362667 85.333333 512 85.333333s426.666667 191.029333 426.666667 426.666667c0 78.293333-21.152 153.568-60.586667 219.274667zM555.232 512l86.474667 86.474667a30.570667 30.570667 0 1 1-43.232 43.232L512 555.232l-86.474667 86.474667a30.570667 30.570667 0 1 1-43.232-43.232L468.768 512l-86.474667-86.474667a30.570667 30.570667 0 1 1 43.232-43.232L512 468.768l86.474667-86.474667a30.570667 30.570667 0 1 1 43.232 43.232L555.232 512z\" p-id=\"329\"></path></svg>\r\n  \t\t\t</span>\r\n  \t\t</div>\r\n  \t\t<button class=\"button\" @click=\"getcontent\">获取内容</button>\r\n  \t\t<button class=\"button\" @click=\"addEmoji('http://www.fuhao114.com/uploads/allimg/150628/0Z04H148-22.png')\">插入emoji</button>\r\n  \t\t<div class=\"exportContent\" v-html=\"lineFeed(exportContent)\"></div>\r\n  \t</div>\r\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'EmojiComponent',\n  props: {\n    showWordLimit: { //是否显示输入字数统计\r\n    \ttype: Boolean,\r\n    \tdefault: true\r\n    },\r\n    clearable: { //是否可清空\r\n    \ttype: Boolean,\r\n    \tdefault: true\r\n    },\r\n    max: { //可输入的最大长度\r\n    \ttype: Number,\r\n    \tdefault: 30\r\n    },\r\n    placeholder: { //占位符\r\n    \ttype: String,\r\n    \tdefault: '请输入内容'\r\n    },\r\n    content: { //绑定值\r\n    \ttype: String,\r\n    \tdefault: ''\r\n    }\n  },\r\n\tdata(){\r\n\t\treturn {\r\n\t\t\tstartOffset: 0,\r\n\t\t\trange: null,\r\n\t\t\ttotal: 0,\r\n\t\t\ttyping: false, //是否正在输入\r\n\t\t\texportContent: '',\r\n\t\t\tcanEdit: 'plaintext-only',\r\n\t\t}\r\n\t},\r\n\tmounted(){\r\n\t\tthis.init()\r\n\t},\r\n\tmethods: {\r\n\t\tlineFeed(h){\r\n\t\t\t//输出换行符\r\n\t\t\treturn h.replace(/[\\r\\n]/g, '<br>')\r\n\t\t},\r\n\t\tinit(){\r\n\t\t\t//初始化\r\n\t\t\tlet $content = document.querySelector('#contenteditable'),\r\n\t\t\t\trange = this.range,\r\n\t\t\t\tselection = getSelection()\r\n\t\t\t$content.innerHTML = this.content\r\n\t\t\t$content.focus()\r\n\t\t\trange = selection.getRangeAt(0)\r\n\t\t\trange.selectNodeContents($content)\r\n\t\t\trange.collapse(false)\r\n\t\t\tselection.removeAllRanges()\r\n\t\t\tselection.addRange(range)\r\n\t\t\tthis.calc()\r\n\t\t},\r\n\t\tgetcontent(){\r\n\t\t\t//获取内容\r\n\t\t\tthis.exportContent = this.content.replace(/<((?!img).+?)>/g, ($1, $2) => `&lt;${$2}&gt;`).trim()\r\n\t\t\tthis.$emit('getContent', {content: this.exportContent})\r\n\t\t},\r\n\t\tclear(){\r\n\t\t\t//清空内容 重置\r\n\t\t\tthis.content = ''\r\n\t\t\tthis.exportContent = ''\r\n\t\t\tthis.total = 0\r\n\t\t\tthis.startOffset = 0\r\n\t\t\tdocument.querySelector('#contenteditable').innerHTML = ''\r\n\t\t},\r\n\t\tkeydown(e){\r\n\t\t\t//达到最大字数时，除了删除shift方向键，其他不可用\r\n\t\t\tconst key = e.keyCode || e.which\r\n\t\t\tif (this.total >= this.max) {\r\n\t\t\t\tif (key != 8 && key != 46 && key != 16 && key != 37 && key != 38 && key != 39 && key != 40) {\r\n\t\t\t\t\tthis.canEdit = false\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.canEdit = 'plaintext-only'\r\n\t\t\t\t\t}, 0)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tcalc(){\r\n\t\t\t//计算字数\r\n\t\t\tconst $content = document.querySelector('#contenteditable')\r\n\t\t\tlet emojiTimes = 0\r\n\t\t\tfor (let i = 0; i < $content.childNodes.length; i++) {\r\n\t\t\t\tconst { nodeName } = $content.childNodes[i]\r\n\t\t\t\tif (nodeName.toLowerCase() == 'img') emojiTimes++\r\n\t\t\t}\r\n\t\t\tthis.total = $content.innerText.replace(/\\s{1}[\\r\\n]/g, '-').trim().length + emojiTimes\r\n\t\t\tif (this.total > this.max){\r\n\t\t\t\tlet out = '', i = 0\r\n\t\t\t\tfor (let c = 0; c < $content.childNodes.length; c++) {\r\n\t\t\t\t\tif (i > this.max) break\r\n\t\t\t\t\tconst $c = $content.childNodes[c]\r\n\t\t\t\t\tif ($c.nodeName.toLowerCase() == 'img') {\r\n\t\t\t\t\t\tout += $c.outerHTML\r\n\t\t\t\t\t\ti++\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst $n = $c.nodeValue, len = $n.length\r\n\t\t\t\t\t\ti += len\r\n\t\t\t\t\t\ti <= this.max ? out += $n : out += $n.substr(0, len + this.max - i)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.content = out\r\n\t\t\t\t$content.innerHTML = out\r\n\t\t\t\tthis.total = this.max\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t\treturn true\r\n\t\t},\r\n\t\tinput(){\r\n\t\t\t//定时器确保compositionend已经执行\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tif (this.typing || !this.calc() || this.total >= this.max) return\r\n\t\t\t\tconst $content = document.querySelector('#contenteditable'),\r\n\t\t\t\t\tchild = $content.childNodes\r\n\t\t\t\t$content.scrollTop = $content.offsetHeight\r\n\t\t\t\tthis.content = [...child].map(i => i.nodeName.toLowerCase() == 'img' ? i.outerHTML : i.nodeValue).join('')\r\n\t\t\t}, 0)\r\n\t\t},\r\n\t\tfocus(e){\r\n\t\t\t//点击或聚焦\r\n\t\t\tif (e.target.id != 'contenteditable') return\r\n\t\t\tconst selection = getSelection()\r\n\t\t\tif (!selection) return\r\n\t\t\tconst node = selection.anchorNode\r\n\t\t\tif (!node) return\r\n\t\t\tthis.range = selection.getRangeAt(0)\r\n\t\t\tthis.startOffset = this.range.startOffset\r\n\t\t},\r\n\t\taddEmoji(src){\r\n\t\t\t//添加Emoji\r\n\t\t\tif (this.total >= this.max) return\r\n\t\t\tlet $content = document.querySelector('#contenteditable'),\r\n\t\t\t\trange = this.range,\r\n\t\t\t\tselection = getSelection(),\r\n\t\t\t\temoji = document.createElement(\"img\")\r\n\t\t\temoji.src = src;\r\n\t\t\tif (!range || !selection.anchorNode) {\r\n\t\t\t\trange = document.createRange()\r\n\t\t\t\trange.selectNodeContents($content)\r\n\t\t\t\t$content.focus()\r\n\t\t\t}\r\n\t\t\tconst\ttextNode = range.startContainer,\r\n\t\t\t\tisBr = textNode.nodeName.toLowerCase() == 'br',\r\n\t\t\t\tchild = $content.childNodes\r\n\t\t\tif (selection.anchorNode.nodeName != '#text') {\r\n\t\t\t\tif (child.length > 0) {\r\n\t\t\t\t\tfor (let i = 0; i <= child.length; i++) {\r\n\t\t\t\t\t\tif (i == selection.anchorOffset) {\r\n\t\t\t\t\t\t\t$content.insertBefore(emoji, child[i])\r\n\t\t\t\t\t\t\tchild[i + 1] ? range.setStartBefore(child[i + 1]) : range.selectNodeContents($content)\r\n\t\t\t\t\t\t\tbreak\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$content.appendChild(emoji)\r\n\t\t\t\t\trange.selectNodeContents($content)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\trange.insertNode(emoji)\r\n\t\t\t\trange.setStart(textNode, this.startOffset)\r\n\t\t\t}\r\n\t\t\tthis.total++\r\n\t\t\tthis.content = [...child].map(i => i.nodeName.toLowerCase() == 'img' ? i.outerHTML : i.nodeValue).join('')\r\n\t\t\trange.collapse(false)\r\n\t\t\tselection.removeAllRanges()\r\n\t\t\tselection.addRange(range)\r\n\t\t}\r\n\t}\n}\n</script>\n\n<style lang=\"scss\" scoped>\r\n\t.emoji-main {\n\t\t.teatarea {\r\n\t\t\twidth: 100%;\r\n\t\t\tmargin: 0 auto;\r\n\t\t\t.field {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\t#contenteditable {\r\n\t\t\t\t\tmargin: 12px 0;\r\n\t\t\t\t\tpadding: 10px 12px 32px;\r\n\t\t\t\t\tline-height: 1.8;\r\n\t\t\t\t\tmax-height: 100px;\r\n\t\t\t\t\tborder: 1px solid #ddd;\r\n\t\t\t\t\tborder-radius: 5px;\r\n\t\t\t\t\tfont-size: 14px;\r\n\t\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\t\toutline: none;\r\n\t\t\t\t\toverflow-y: auto;\r\n\t\t\t\t\t&:focus {\r\n\t\t\t\t\t\tborder: 1px solid #409eff;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t&:empty::before {\r\n\t\t\t\t\t\tcolor: #ddd;\r\n\t\t\t\t\t\tcontent: attr(placeholder);\r\n\t\t\t\t\t}\r\n\t\t\t\t\timg {\r\n\t\t\t\t\t\tvertical-align: bottom;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t.wordLimit {\r\n\t\t\t\t\t\tpadding-bottom: 10px;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t.total, .clear {\r\n\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\tbottom: 1px;\r\n\t\t\t\t\tleft: 12px;\r\n\t\t\t\t\tbackground: #fff;\r\n\t\t\t\t\tcolor: #aaa;\r\n\t\t\t\t\tfont-size: 12px;\r\n\t\t\t\t\tpadding: 6px;\r\n\t\t\t\t\tpointer-events: none;\r\n\t\t\t\t}\r\n\t\t\t\t.clear {\r\n\t\t\t\t\tleft: auto;\r\n\t\t\t\t\tright: 12px;\r\n\t\t\t\t\tbottom: 4px;\r\n\t\t\t\t\tcursor: pointer;\r\n\t\t\t\t\tpadding: 0;\r\n\t\t\t\t\tpointer-events: all;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t.exportContent {\r\n\t\t\t\tmargin: 30px 0;\r\n\t\t\t\timg {\r\n\t\t\t\t\tvertical-align: bottom;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t.em-button {\r\n\t\t\t\tbackground: #409eff;\r\n\t\t\t\tpadding: 6px 10px;\r\n\t\t\t\tcolor: #fff;\r\n\t\t\t\tborder-radius: 5px;\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t\tborder: 0;\r\n\t\t\t\tfont-size: 14px;\r\n\t\t\t\toutline: none;\r\n\t\t\t\t&:active {\r\n\t\t\t\t\tborder: 0;\r\n\t\t\t\t\toutline: none;\r\n\t\t\t\t}\r\n\t\t\t\t&:hover {\r\n\t\t\t\t\topacity: .8;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\n</style>\n"]}]}